using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Model;
using Dapper;
using System.Data.SqlClient;

namespace DAO
{
    public class CfsecondkDAO
    {

        string conStr = "Data Source=.;Initial Catalog=HR_DB;Integrated Security=True";


        /// <summary>
        /// 二级查询
        /// </summary>
        /// <returns></returns>
        public async Task<IEnumerable<Config_file_second_kind>> TwoKindSelectTypeAsync()
        {
            using (SqlConnection connection = new SqlConnection(conStr))
            {
                string sql = "select * from [dbo].[config_file_second_kind]";
                return await connection.QueryAsync<Config_file_second_kind>(sql);
            }
        }

        /// <summary>
        /// 查询一级机构名称
        /// </summary>
        /// <returns></returns>
        public async Task<IEnumerable<Config_file_first_kind>> XSTypeAsync()
        {
            using (SqlConnection connection = new SqlConnection(conStr))
            {
                string sql = "select [first_kind_id],[first_kind_name] from [dbo].[config_file_first_kind]";
                return await connection.QueryAsync<Config_file_first_kind>(sql);
            }
        }

        /// <summary>
        /// 二级删除
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        public async Task<int> TwoCDelectAsync(int id)
        {
            using (SqlConnection connection = new SqlConnection(conStr))
            {
                string sql = $@"delete from [dbo].[config_file_second_kind] where fsk_id={id}";
                return await connection.ExecuteAsync(sql);
            }
        }

        /// <summary>
        ///二级添加
        /// </summary>
        /// <param name="config"></param>
        /// <returns></returns>
        public async Task<int> TinaTwoAsync(Config_file_second_kind config)
        {
            using (SqlConnection sqlConnection = new SqlConnection(conStr))
            {
                string sql = $@"insert into [dbo].[config_file_second_kind] (first_kind_name,second_kind_id,second_kind_name,second_salary_id,second_sale_id) values('{config.first_kind_name}',(select max(second_kind_id)+1 from [dbo].[config_file_second_kind]),'{config.second_kind_name}','{config.second_salary_id}','{config.second_sale_id}')";
                return await sqlConnection.ExecuteAsync(sql);
            }
        }

        /// <summary>
        /// 查询一个具体信息
        /// </summary>
        /// <param name="id"></param>
        /// <returns></returns>
        public async Task<Config_file_second_kind> ChaXunTwoAsync(int id)
        {
            using (SqlConnection sqlConnection = new SqlConnection(conStr))
            {
                string sql = $"Select * FROM [dbo].[config_file_second_kind] Where fsk_id='{id}'";
                return await sqlConnection.QueryFirstAsync<Config_file_second_kind>(sql);
            }
        }

        /// <summary>
        /// 二级修改
        /// </summary>
        /// <param name="config"></param>
        /// <returns></returns>
        public async Task<int> XiuGaiTwo(Config_file_second_kind config)
        {
            using (SqlConnection sqlConnection = new SqlConnection(conStr))
            {
                string sql = $"UPDATE [dbo].[Config_file_second_kind] SET  second_salary_id='{config.second_salary_id}', second_sale_id='{config.second_sale_id}' WHERE [fsk_id]='{config.fsk_id}'";
                return await sqlConnection.ExecuteAsync(sql);
            }
        }
    }
}
